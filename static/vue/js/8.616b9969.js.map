{"version":3,"sources":["webpack:///src/views/randomMsg/components/music.vue","webpack:///./src/views/randomMsg/components/music.vue?4392","webpack:///./src/views/randomMsg/components/music.vue"],"names":["music","name","getMusic","audioEvent","_this","this","length","aid","artist","has_loved","load","play","audio","pause","isPlaying","_this2","progress","left","offsetWidth","currentTime","currentPercent","t","clientX","progressW","percent","sec","components_music","render","_h","$createElement","_c","_self","staticClass","class","_v","attrs","src","song","picture","on","click","toggleAudio","ref","url","_s","title","style","width","currentLoaded","totalTime","staticRenderFns","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"6LA2BAA,6DAQA,eACA,YACA,eACA,sBACA,oBACA,cACA,WACA,aAEA,WAEA,uEAEAC,WACAC,oCAGAC,sDAIA,mCAIA,IAAAC,EAAAC,qIACA,gCACA,mDACA,cACA,kCACAC,0BAEA,+DAEAC,uCACAC,OAAA,SACA,wBAGAC,iDAEAC,wBAEA,gBACAC,kHAOAC,0BAEAC,6BACAC,kCAEA,IAAAC,EAAAV,kBACAO,mBACAI,qCACAC,SAEAC,mGAMAC,sDACA,kCAEA,cAEA,gCAEAC,wIAMAC,8DACA,SAEA,iEAIA,eAeA,2EAZA,IACAC,WACAC,gBACAC,sBACA,uBASA,2DANA,2DACA,uCACAL,0BAKA,uCAIA,2BAEA,kBACA,yCACAM,MChJAC,GADiBC,OAFjB,WAA0B,IAAaC,EAAbvB,KAAawB,eAA0BC,EAAvCzB,KAAuC0B,MAAAD,IAAAF,EAAwB,OAAAE,EAAA,OAAiBE,YAAA,cAAwBF,EAAA,OAAYE,YAAA,gBAA0BF,EAAA,OAAYE,YAAA,YAAAC,OAA+BtB,KAAzLN,KAAyLS,aAAzLT,KAA+M6B,GAAA,KAAAJ,EAAA,OAAwBE,YAAA,UAAoBF,EAAA,OAAYE,YAAA,YAAAC,OAA+BtB,KAAtSN,KAAsSS,WAAqBqB,OAAQC,IAAnU/B,KAAmUgC,KAAAC,WAAnUjC,KAA2V6B,GAAA,KAAAJ,EAAA,OAAwBE,YAAA,WAAAC,OAA8BtB,KAAjZN,KAAiZS,WAAqByB,IAAKC,MAA3anC,KAA2aoC,iBAA3apC,KAAoc6B,GAAA,KAAAJ,EAAA,SAA4BY,IAAA,UAAYZ,EAAA,UAAeK,OAAOC,IAAlgB/B,KAAkgBgC,KAAAM,SAAlgBtC,KAAshB6B,GAAA,KAAAJ,EAAA,KAAwBE,YAAA,eAA9iB3B,KAAukB6B,GAAvkB7B,KAAukBuC,GAAvkBvC,KAAukBgC,KAAAQ,UAAvkBxC,KAAukB6B,GAAA,KAAAJ,EAAA,KAAuDE,YAAA,WAA9nB3B,KAAmpB6B,GAAnpB7B,KAAmpBuC,GAAnpBvC,KAAmpBgC,KAAA7B,aAAnpBH,KAAmpB6B,GAAA,KAAAJ,EAAA,OAA4DE,YAAA,kBAA4BF,EAAA,KAAUE,YAAA,cAArvB3B,KAA6wB6B,GAA7wB7B,KAA6wBuC,GAA7wBvC,KAA6wBc,gBAA7wBd,KAA6wB6B,GAAA,KAAAJ,EAAA,OAA0DY,IAAA,WAAAV,YAAA,sBAA+CF,EAAA,OAAYE,YAAA,mBAAAc,OAAuCC,MAAz6B1C,KAAy6Be,kBAAz6Bf,KAAq8B6B,GAAA,KAAAJ,EAAA,OAAwBE,YAAA,wBAAAc,OAA4C7B,KAAzgCZ,KAAygCe,kBAAzgCf,KAAoiC6B,GAAA,KAAAJ,EAAA,OAAwBE,YAAA,uBAAAc,OAA2CC,MAAvmC1C,KAAumC2C,mBAAvmC3C,KAAkoC6B,GAAA,KAAAJ,EAAA,KAAwBE,YAAA,cAA1pC3B,KAAkrC6B,GAAlrC7B,KAAkrCuC,GAAlrCvC,KAAkrC4C,mBAE3rCC,oBCCjB,IAcAC,EAdAC,EAAA,OAcAC,CACArD,EACA0B,GATA,EAVA,SAAA4B,GACAF,EAAA,SAaA,kBAEA,MAUAG,EAAA,QAAAJ,EAAA","file":"vue/js/8.616b9969.js","sourcesContent":["<template>\n    <div class=\"song-main\" >\n            <div class=\"song-detail\">\n                <div class=\"play-pole\" :class=\"{ play:isPlaying }\"></div>\n                <div class=\"cover\">\n                  <img :src=\"song.picture\" class=\"cover-img\" :class=\"{ play:isPlaying }\">\n                  <div class=\"play-btn\" :class=\"{ play:isPlaying }\"@click=\"toggleAudio\"></div>\n                </div>\n                <audio ref=\"audio\">\n                  <source :src=\"song.url\">\n                </audio>\n                <p class=\"song-title\">{{ song.title }}</p>\n                <p class=\"artist\">{{ song.artist }}</p>\n            </div>\n            <div class=\"song-progress\">\n              <i class=\"song-time\">{{ currentTime }}</i>\n              <div class=\"song-progress-out\" ref=\"progress\">\n                <div class=\"song-progress-in\" :style=\"{width: currentPercent}\"></div>\n                <div class=\"song-progress-pointer\" :style=\"{left: currentPercent}\"></div>\n                <div class=\"song-progress-loaded\" :style=\"{width: currentLoaded}\"></div>\n              </div>\n              <i class=\"song-time\">{{ totalTime }}</i>\n            </div>\n    </div>\n</template>\n\n<script>\nimport axios from 'utils/curl';\nexport default {\n  data() {\n    return {\n      song: {},\n      lyric: [],\n      record: {\n        media_url: ''\n      },\n      isPlaying: false,\n      totalTime: '',\n      currentTime: '00:00',\n      currentLoaded: '0%',\n      currentPercent: '0%',\n      isTouch: false,\n      hasData: false,\n      showLyric: false\n    }\n  },\n  props: ['status'],\n  created() {\n    this.$store.dispatch('onType', this.$route.name)\n    this.getMusic()\n  },\n  mounted (){\n    this.audioEvent()\n  },\n  watch: {\n  \tstatus (){\n  \t\tthis.getMusic(true)\n  \t}\n  },\n  methods: {\n  \tasync getMusic (next){\n      this.$store.dispatch('openLoading')\n  \t\tlet data = await axios.get('/api/random/music')\n    \tthis.song = data.song[0]\n    \tthis.hasData = true\n  \t\tthis.totalTime = this.formatTime(this.song.length)\n      this.$store.dispatch('closeLoading')\n\n      this.$store.dispatch('getLoveData',{\n        loveId: this.song.aid,\n        title: `${this.song.albumtitle}(${this.song.artist})`,\n        type: 'music',\n        hasLoved: this.song.has_loved\n      })\n\n  \t\tthis.$nextTick(() => {\n\t    \tthis.$refs.audio.load()\n\t    \tif(next){\n\t    \t\tthis.isPlaying = true\n\t    \t\tthis.$refs.audio.play()\n\t    \t}\n\t  \t})\n  \t},\n    toggleAudio (){\n      if (!this.hasData) return\n\n      let $audio = this.$refs.audio\n      $audio.paused ? $audio.play() : $audio.pause()\n\n      this.isPlaying = !this.isPlaying\n    },\n    audioEvent (){\n      let $audio = this.$refs.audio\n      let $progress = this.$refs.progress\n      let progressX = $progress.getBoundingClientRect().left\n      let progressW = $progress.offsetWidth\n\n      $audio.addEventListener('timeupdate', () => {\n        if (this.isTouch){\n          return\n        }\n        this.currentTime = this.formatTime($audio.currentTime)\n\n        let percent = ($audio.currentTime / $audio.duration).toFixed(4)\n        if (parseInt(percent) === 1){\n          this.isPlaying = false\n          // next\n          this.getMusic(true)\n        }\n        this.currentPercent = !isNaN(percent) ? `${percent * 100}%` : this.currentPercent\n      })\n\n      $audio.addEventListener('progress', () => {\n        let t = setInterval(() => {\n          if ($audio.buffered.length !== 0){\n            clearInterval(t)\n            this.currentLoaded = `${(($audio.buffered.end(0) / $audio.duration) * 100).toFixed(2)}%`\n          }\n        }, 1000)\n      })\n\n      function startSlide(e){\n        this.isTouch = true\n      }\n      function moveSlide(e){\n        let touch = e.touches && e.touches[0]\n        let clientX = touch.clientX\n        let percent = (clientX - progressX) / progressW\n        percent = percent < 0 ? 0 : percent > 1 ? 1 : percent\n        this.currentPercent = `${percent * 100}%`\n      }\n      function endSlide(e){\n        this.isTouch = false\n        $audio.currentTime = $audio.duration * parseFloat(this.currentPercent) / 100\n        this.currentTime = this.formatTime($audio.currentTime)\n      }\n\n      $progress.addEventListener('touchstart', startSlide.bind(this), false)\n      $progress.addEventListener('touchmove', moveSlide.bind(this), false)\n      $progress.addEventListener('touchend', endSlide.bind(this), false)\n    },\n    formatTime (time){\n      if (!time){\n        return '00:00'\n      }\n      let min = Math.floor(time / 60)\n      let sec = Math.ceil(time % 60)\n      return `${min < 10 ? `0${min}` : min}:${sec < 10 ? `0${sec}` : sec}`\n    }\n  }\n}\n</script>\n<style lang=\"scss\" scoped>\n@import '~css/common/var';\n@import '~css/common/mixin';\n.song-main{\n\tposition: relative;\n\ttop: vw(-18);\n}\n.song-detail{\n  position: relative;\n  padding-top: vw(20);\n  margin-bottom: vw(30);\n  text-align: center;\n}\n.play-pole{\n  position: absolute;\n  left: 53%;\n  top: vw(-26);\n  margin-left: vw(-45);\n  z-index: 9;\n  width: vw(48);\n  height: vw(162);\n  background: url(~img/random/play-pole.png) no-repeat left top;\n  background-size: 100%;\n  transform: rotate(-70deg);\n  transform-origin: 32px 25px;\n  transition: transform .5s linear;\n  &.play{\n    transform: rotate(-50deg);\n  }\n}\n.cover{\n\tposition: relative;\n\tmargin-bottom: vw(15);\n}\n.cover-img{\n  width: vw(270);\n  height: vw(270);\n  border: vw(5) solid rgba(0,0,0,.5);\n  border-radius: 50%;\n  animation-duration: 20s;\n  animation-fill-mode: both;\n  animation-iteration-count: infinite;\n  animation-timing-function: linear;  \n  &.play{\n    animation-name: rotate;\n  }\n}\n.play-btn{\n  @include center;\n  width: vw(60);\n  height: vw(60);\n  background: url(~img/random/btn-pause.png) no-repeat left top;\n  background-size: 100%;\n  &.play{\n    background-image: url(~img/random/btn-play.png);\n  }\n}\n.lyric-tips{\n  font-size: vw(18);\n}\n.song-title{\n  font-size: vw(20);\n  margin-bottom: vw(10);\n  line-height: 1.2;\n  color: $commonColor;\n}\n.artist{\n\tcolor: #666;\n}\n.song-desc{\n  font-size: vw(15);\n}\n.song-progress{\n  position: relative;\n  display: flex;\n  justify-content: center;\n  align-items:center;\n}\n.song-time{\n  font-size: vw(13);\n  margin: 0 vw(6);\n}\n.song-progress-out{\n  position: relative;\n  width: vw(236);\n  height: vw(16);\n  &:before{\n    @include center;\n    width: 100%;\n    content: '';\n    background-color: rgba(250,125,60,.5);\n    height: vw(2);\n  }\n}\n.song-progress-in{\n  position: absolute;\n  left: 0;\n  top: 50%;\n  transform: translate(0,-50%);\n  z-index: 3;\n  height: vw(2);\n  background-color: #ff3f22;\n}\n.song-progress-pointer{\n  position: absolute;\n  left: 0;\n  top: 50%;\n  transform: translate(0,-50%);\n  z-index: 10;\n  width: vw(8);\n  height: vw(8);\n  border-radius: 50%;\n  background-color: #ff3f22;\n}\n.song-progress-loaded{\n  position: absolute;\n  left: 0;\n  top: 50%;\n  transform: translate(0,-50%);\n  z-index: 2;\n  width: vw(150);\n  height: vw(2);\n  background-color: $commonColor;\n}\n@keyframes rotate {\n  from { transform: rotate(0deg); }\n  to   { transform: rotate(360deg); }\n}\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/views/randomMsg/components/music.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"song-main\"},[_c('div',{staticClass:\"song-detail\"},[_c('div',{staticClass:\"play-pole\",class:{ play:_vm.isPlaying }}),_vm._v(\" \"),_c('div',{staticClass:\"cover\"},[_c('img',{staticClass:\"cover-img\",class:{ play:_vm.isPlaying },attrs:{\"src\":_vm.song.picture}}),_vm._v(\" \"),_c('div',{staticClass:\"play-btn\",class:{ play:_vm.isPlaying },on:{\"click\":_vm.toggleAudio}})]),_vm._v(\" \"),_c('audio',{ref:\"audio\"},[_c('source',{attrs:{\"src\":_vm.song.url}})]),_vm._v(\" \"),_c('p',{staticClass:\"song-title\"},[_vm._v(_vm._s(_vm.song.title))]),_vm._v(\" \"),_c('p',{staticClass:\"artist\"},[_vm._v(_vm._s(_vm.song.artist))])]),_vm._v(\" \"),_c('div',{staticClass:\"song-progress\"},[_c('i',{staticClass:\"song-time\"},[_vm._v(_vm._s(_vm.currentTime))]),_vm._v(\" \"),_c('div',{ref:\"progress\",staticClass:\"song-progress-out\"},[_c('div',{staticClass:\"song-progress-in\",style:({width: _vm.currentPercent})}),_vm._v(\" \"),_c('div',{staticClass:\"song-progress-pointer\",style:({left: _vm.currentPercent})}),_vm._v(\" \"),_c('div',{staticClass:\"song-progress-loaded\",style:({width: _vm.currentLoaded})})]),_vm._v(\" \"),_c('i',{staticClass:\"song-time\"},[_vm._v(_vm._s(_vm.totalTime))])])])}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-3d34a475\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/views/randomMsg/components/music.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-3d34a475\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!sass-loader?{\\\"sourceMap\\\":true}!../../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./music.vue\")\n}\nvar normalizeComponent = require(\"!../../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../../../node_modules/vue-loader/lib/selector?type=script&index=0!./music.vue\"\nimport __vue_script__ from \"!!babel-loader!../../../../node_modules/vue-loader/lib/selector?type=script&index=0!./music.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-3d34a475\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../../node_modules/vue-loader/lib/selector?type=template&index=0!./music.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-3d34a475\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/views/randomMsg/components/music.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}