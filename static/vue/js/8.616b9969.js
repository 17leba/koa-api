webpackJsonp([8],{krxR:function(t,s){},nKrM:function(t,s,i){"use strict";Object.defineProperty(s,"__esModule",{value:!0});var e=i("Xxa5"),n=i.n(e),a=i("exGp"),r=i.n(a),o=i("qYvl"),c=i.n(o),u={data:function(){return{song:{},lyric:[],record:{media_url:""},isPlaying:!1,totalTime:"",currentTime:"00:00",currentLoaded:"0%",currentPercent:"0%",isTouch:!1,hasData:!1,showLyric:!1}},props:["status"],created:function(){this.$store.dispatch("onType",this.$route.name),this.getMusic()},mounted:function(){this.audioEvent()},watch:{status:function(){this.getMusic(!0)}},methods:{getMusic:function(t){var s=this;return r()(n.a.mark(function i(){var e;return n.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return s.$store.dispatch("openLoading"),i.next=3,c.a.get("/api/random/music");case 3:e=i.sent,s.song=e.song[0],s.hasData=!0,s.totalTime=s.formatTime(s.song.length),s.$store.dispatch("closeLoading"),s.$store.dispatch("getLoveData",{loveId:s.song.aid,title:s.song.albumtitle+"("+s.song.artist+")",type:"music",hasLoved:s.song.has_loved}),s.$nextTick(function(){s.$refs.audio.load(),t&&(s.isPlaying=!0,s.$refs.audio.play())});case 10:case"end":return i.stop()}},i,s)}))()},toggleAudio:function(){if(this.hasData){var t=this.$refs.audio;t.paused?t.play():t.pause(),this.isPlaying=!this.isPlaying}},audioEvent:function(){var t=this,s=this.$refs.audio,i=this.$refs.progress,e=i.getBoundingClientRect().left,n=i.offsetWidth;s.addEventListener("timeupdate",function(){if(!t.isTouch){t.currentTime=t.formatTime(s.currentTime);var i=(s.currentTime/s.duration).toFixed(4);1===parseInt(i)&&(t.isPlaying=!1,t.getMusic(!0)),t.currentPercent=isNaN(i)?t.currentPercent:100*i+"%"}}),s.addEventListener("progress",function(){var i=setInterval(function(){0!==s.buffered.length&&(clearInterval(i),t.currentLoaded=(s.buffered.end(0)/s.duration*100).toFixed(2)+"%")},1e3)}),i.addEventListener("touchstart",function(t){this.isTouch=!0}.bind(this),!1),i.addEventListener("touchmove",function(t){var s=((t.touches&&t.touches[0]).clientX-e)/n;s=s<0?0:s>1?1:s,this.currentPercent=100*s+"%"}.bind(this),!1),i.addEventListener("touchend",function(t){this.isTouch=!1,s.currentTime=s.duration*parseFloat(this.currentPercent)/100,this.currentTime=this.formatTime(s.currentTime)}.bind(this),!1)},formatTime:function(t){if(!t)return"00:00";var s=Math.floor(t/60),i=Math.ceil(t%60);return(s<10?"0"+s:s)+":"+(i<10?"0"+i:i)}}},h={render:function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"song-main"},[s("div",{staticClass:"song-detail"},[s("div",{staticClass:"play-pole",class:{play:this.isPlaying}}),this._v(" "),s("div",{staticClass:"cover"},[s("img",{staticClass:"cover-img",class:{play:this.isPlaying},attrs:{src:this.song.picture}}),this._v(" "),s("div",{staticClass:"play-btn",class:{play:this.isPlaying},on:{click:this.toggleAudio}})]),this._v(" "),s("audio",{ref:"audio"},[s("source",{attrs:{src:this.song.url}})]),this._v(" "),s("p",{staticClass:"song-title"},[this._v(this._s(this.song.title))]),this._v(" "),s("p",{staticClass:"artist"},[this._v(this._s(this.song.artist))])]),this._v(" "),s("div",{staticClass:"song-progress"},[s("i",{staticClass:"song-time"},[this._v(this._s(this.currentTime))]),this._v(" "),s("div",{ref:"progress",staticClass:"song-progress-out"},[s("div",{staticClass:"song-progress-in",style:{width:this.currentPercent}}),this._v(" "),s("div",{staticClass:"song-progress-pointer",style:{left:this.currentPercent}}),this._v(" "),s("div",{staticClass:"song-progress-loaded",style:{width:this.currentLoaded}})]),this._v(" "),s("i",{staticClass:"song-time"},[this._v(this._s(this.totalTime))])])])},staticRenderFns:[]};var d=i("VU/8")(u,h,!1,function(t){i("krxR")},"data-v-3d34a475",null);s.default=d.exports}});
//# sourceMappingURL=8.616b9969.js.map